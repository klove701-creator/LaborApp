<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보고서</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>보고서</h1>
            <div class="header-info">
                <a href="{{ url_for('admin_dashboard') }}" class="back-btn">← 대시보드로</a>
                <a href="{{ url_for('logout') }}" class="logout-btn">로그아웃</a>
            </div>
        </div>

        <!-- 전체 요약 카드 -->
        <div class="summary-cards">
            <div class="summary-card">
                <h3>총 프로젝트</h3>
                <div class="summary-number">{{ reports_data.total_projects|format_currency }}</div>
                <p>개</p>
            </div>
            <div class="summary-card">
                <h3>총 출역 인원</h3>
                <div class="summary-number">{{ reports_data.total_workers|format_currency }}</div>
                <p>명</p>
            </div>
            <div class="summary-card">
                <h3>총 노무비</h3>
                <div class="summary-number">{{ reports_data.total_cost|format_currency }}</div>
                <p>원</p>
            </div>
            <div class="summary-card">
                <h3>등록 공종</h3>
                <div class="summary-number">{{ reports_data.total_work_types|format_currency }}</div>
                <p>개</p>
            </div>
        </div>

        <!-- 프로젝트별 상세 보고서 -->
        <div class="projects-reports-section">
            <h2>프로젝트별 현황</h2>
            {% if reports_data.projects_summary %}
            <div class="reports-table-wrapper">
                <table class="reports-table">
                    <thead>
                        <tr>
                            <th>프로젝트명</th>
                            <th>공종수</th>
                            <th>총 출역</th>
                            <th>총 비용</th>
                            <th>작업일수</th>
                            <th>평균 진행률</th>
                            <th>상세보기</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in reports_data.projects_summary %}
                        <tr>
                            <td class="project-name">{{ project.name }}</td>
                            <td>{{ project.work_types_count }}개</td>
                            <td class="number">{{ project.total_workers|format_currency }}명</td>
                            <td class="cost">{{ project.total_cost|format_currency }}원</td>
                            <td>{{ project.working_days }}일</td>
                            <td class="progress">{{ project.avg_progress }}%</td>
                            <td>
                                <button class="detail-btn" onclick="alert('상세보기 기능은 향후 추가 예정입니다.')">상세보기</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-reports">
                <h3>데이터가 없습니다</h3>
                <p>프로젝트에서 출역 데이터를 입력하면 보고서가 생성됩니다.</p>
            </div>
            {% endif %}
        </div>

        <!-- 분석 카드 -->
        <div class="analysis-section">
            <h2>데이터 분석</h2>
            <div class="analysis-cards">
                <div class="analysis-card">
                    <h3>평균 일일 출역</h3>
                    <div class="analysis-number">
    {% if reports_data.projects_summary %}
        {% set total_days = reports_data.projects_summary|sum(attribute='working_days') %}
        {% if total_days > 0 %}
            {{ (reports_data.total_workers / total_days)|round(1)|format_currency }}명
        {% else %}
            0명
        {% endif %}
    {% else %}
        0명
    {% endif %}
</div>
                </div>
                <div class="analysis-card">
                    <h3>평균 프로젝트 비용</h3>
                    <div class="analysis-number">
    {% if reports_data.projects_summary %}
        {{ ((reports_data.total_cost / reports_data.projects_summary|length)|int)|format_currency }}원
    {% else %}
        0원
    {% endif %}
</div>
                </div>
                <div class="analysis-card">
                    <h3>가장 활발한 프로젝트</h3>
                    <div class="analysis-text">
                        {% if reports_data.projects_summary %}
                            {% set max_project = reports_data.projects_summary|max(attribute='total_workers') %}
                            {{ max_project.name }}
                        {% else %}
                            없음
                        {% endif %}
                    </div>
                </div>
                <div class="analysis-card">
                    <h3>평균 진행률</h3>
                    <div class="analysis-number">
                        {% if reports_data.projects_summary %}
                            {% set total_progress = reports_data.projects_summary|sum(attribute='avg_progress') %}
                            {{ "%.1f"|format(total_progress / reports_data.projects_summary|length) }}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- 데이터 내보내기 -->
        <div class="export-section">
            <h2>데이터 내보내기</h2>
            <div class="export-buttons">
                <a href="{{ url_for('export_csv') }}" class="export-btn csv-btn">
                    📊 CSV 다운로드
                </a>
                <button class="export-btn pdf-btn" onclick="window.print()">
                    📄 페이지 인쇄
                </button>
                <button class="export-btn info-btn" onclick="alert('추가 내보내기 기능은 향후 업데이트 예정입니다.')">
                    📈 추가 기능
                </button>
            </div>
        </div>
    </div>

    <script>
        // 간단한 JavaScript만 사용
        document.addEventListener('DOMContentLoaded', function() {
            console.log('보고서 페이지 로드 완료');
            
            // 테이블 행에 호버 효과
            const tableRows = document.querySelectorAll('.reports-table tbody tr');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#404040';
                });
                row.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '#2d2d2d';
                });
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/currency-format.js') }}"></script>
</body>
</body>
</html>