<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ê³ ì„œ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ë³´ê³ ì„œ</h1>
            <div class="header-info">
                <a href="{{ url_for('admin_dashboard') }}" class="back-btn">â† ëŒ€ì‹œë³´ë“œë¡œ</a>
                <a href="{{ url_for('logout') }}" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>

        <!-- ì „ì²´ ìš”ì•½ ì¹´ë“œ -->
        <div class="summary-cards">
            <div class="summary-card">
                <h3>ì´ í”„ë¡œì íŠ¸</h3>
                <div class="summary-number">{{ reports_data.total_projects|format_currency }}</div>
                <p>ê°œ</p>
            </div>
            <div class="summary-card">
                <h3>ì´ ì¶œì—­ ì¸ì›</h3>
                <div class="summary-number">{{ reports_data.total_workers|format_currency }}</div>
                <p>ëª…</p>
            </div>
            <div class="summary-card">
                <h3>ì´ ë…¸ë¬´ë¹„</h3>
                <div class="summary-number">{{ reports_data.total_cost|format_currency }}</div>
                <p>ì›</p>
            </div>
            <div class="summary-card">
                <h3>ë“±ë¡ ê³µì¢…</h3>
                <div class="summary-number">{{ reports_data.total_work_types|format_currency }}</div>
                <p>ê°œ</p>
            </div>
        </div>

        <!-- í”„ë¡œì íŠ¸ë³„ ìƒì„¸ ë³´ê³ ì„œ -->
        <div class="projects-reports-section">
            <h2>í”„ë¡œì íŠ¸ë³„ í˜„í™©</h2>
            {% if reports_data.projects_summary %}
            <div class="reports-table-wrapper">
                <table class="reports-table">
                    <thead>
                        <tr>
                            <th>í”„ë¡œì íŠ¸ëª…</th>
                            <th>ê³µì¢…ìˆ˜</th>
                            <th>ì´ ì¶œì—­</th>
                            <th>ì´ ë¹„ìš©</th>
                            <th>ì‘ì—…ì¼ìˆ˜</th>
                            <th>í‰ê·  ì§„í–‰ë¥ </th>
                            <th>ìƒì„¸ë³´ê¸°</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in reports_data.projects_summary %}
                        <tr>
                            <td class="project-name">{{ project.name }}</td>
                            <td>{{ project.work_types_count }}ê°œ</td>
                            <td class="number">{{ project.total_workers|format_currency }}ëª…</td>
                            <td class="cost">{{ project.total_cost|format_currency }}ì›</td>
                            <td>{{ project.working_days }}ì¼</td>
                            <td class="progress">{{ project.avg_progress }}%</td>
                            <td>
                                <button class="detail-btn" onclick="alert('ìƒì„¸ë³´ê¸° ê¸°ëŠ¥ì€ í–¥í›„ ì¶”ê°€ ì˜ˆì •ì…ë‹ˆë‹¤.')">ìƒì„¸ë³´ê¸°</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-reports">
                <h3>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>í”„ë¡œì íŠ¸ì—ì„œ ì¶œì—­ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>

        <!-- ë¶„ì„ ì¹´ë“œ -->
        <div class="analysis-section">
            <h2>ë°ì´í„° ë¶„ì„</h2>
            <div class="analysis-cards">
                <div class="analysis-card">
                    <h3>í‰ê·  ì¼ì¼ ì¶œì—­</h3>
                    <div class="analysis-number">
    {% if reports_data.projects_summary %}
        {% set total_days = reports_data.projects_summary|sum(attribute='working_days') %}
        {% if total_days > 0 %}
            {{ (reports_data.total_workers / total_days)|round(1)|format_currency }}ëª…
        {% else %}
            0ëª…
        {% endif %}
    {% else %}
        0ëª…
    {% endif %}
</div>
                </div>
                <div class="analysis-card">
                    <h3>í‰ê·  í”„ë¡œì íŠ¸ ë¹„ìš©</h3>
                    <div class="analysis-number">
    {% if reports_data.projects_summary %}
        {{ ((reports_data.total_cost / reports_data.projects_summary|length)|int)|format_currency }}ì›
    {% else %}
        0ì›
    {% endif %}
</div>
                </div>
                <div class="analysis-card">
                    <h3>ê°€ì¥ í™œë°œí•œ í”„ë¡œì íŠ¸</h3>
                    <div class="analysis-text">
                        {% if reports_data.projects_summary %}
                            {% set max_project = reports_data.projects_summary|max(attribute='total_workers') %}
                            {{ max_project.name }}
                        {% else %}
                            ì—†ìŒ
                        {% endif %}
                    </div>
                </div>
                <div class="analysis-card">
                    <h3>í‰ê·  ì§„í–‰ë¥ </h3>
                    <div class="analysis-number">
                        {% if reports_data.projects_summary %}
                            {% set total_progress = reports_data.projects_summary|sum(attribute='avg_progress') %}
                            {{ "%.1f"|format(total_progress / reports_data.projects_summary|length) }}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ë°ì´í„° ë‚´ë³´ë‚´ê¸° -->
        <div class="export-section">
            <h2>ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h2>
            <div class="export-buttons">
                <a href="{{ url_for('export_csv') }}" class="export-btn csv-btn">
                    ğŸ“Š CSV ë‹¤ìš´ë¡œë“œ
                </a>
                <button class="export-btn pdf-btn" onclick="window.print()">
                    ğŸ“„ í˜ì´ì§€ ì¸ì‡„
                </button>
                <button class="export-btn info-btn" onclick="alert('ì¶”ê°€ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì€ í–¥í›„ ì—…ë°ì´íŠ¸ ì˜ˆì •ì…ë‹ˆë‹¤.')">
                    ğŸ“ˆ ì¶”ê°€ ê¸°ëŠ¥
                </button>
            </div>
        </div>
    </div>

    <script>
        // ê°„ë‹¨í•œ JavaScriptë§Œ ì‚¬ìš©
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ë³´ê³ ì„œ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            // í…Œì´ë¸” í–‰ì— í˜¸ë²„ íš¨ê³¼
            const tableRows = document.querySelectorAll('.reports-table tbody tr');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#404040';
                });
                row.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '#2d2d2d';
                });
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/currency-format.js') }}"></script>
</body>
</body>
</html>